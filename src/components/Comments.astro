---
interface Props {
  repo?: string;
  repoId?: string;
  category?: string;
  categoryId?: string;
}

const { 
  repo = 'jthw1005/blog',
  repoId = 'R_kgDOQ3tVqA',
  category = 'General',
  categoryId = 'DIC_kwDOQ3tVqM4C1bFp'
} = Astro.props;
---

<section class="comments mt-12 pt-8 border-t-4 border-[var(--color-border)]">
  <h2 
    class="text-2xl font-bold mb-6"
    style="font-family: var(--font-display);"
  >
    댓글
  </h2>
  
  <div 
    id="giscus-container"
    class="giscus border-2 border-[var(--color-border)] shadow-[4px_4px_0px_0px_var(--color-border)] p-4"
  >
    <p class="text-center text-[var(--color-muted)] py-4">
      Giscus 댓글을 사용하려면 GitHub 저장소 설정이 필요합니다.
      <a 
        href="https://giscus.app/ko" 
        target="_blank" 
        rel="noopener noreferrer"
        class="text-[var(--color-neon-cyan)]"
      >
        Giscus 설정하기
      </a>
    </p>
  </div>
</section>

<script is:inline define:vars={{ repo, repoId, category, categoryId }}>
  function loadGiscus() {
    if (!repoId || !categoryId) return;
    
    const container = document.getElementById('giscus-container');
    if (!container) return;
    
    container.innerHTML = '';
    
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', repo);
    script.setAttribute('data-repo-id', repoId);
    script.setAttribute('data-category', category);
    script.setAttribute('data-category-id', categoryId);
    script.setAttribute('data-mapping', 'pathname');
    script.setAttribute('data-strict', '0');
    script.setAttribute('data-reactions-enabled', '1');
    script.setAttribute('data-emit-metadata', '0');
    script.setAttribute('data-input-position', 'top');
    script.setAttribute('data-theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
    script.setAttribute('data-lang', 'ko');
    script.setAttribute('crossorigin', 'anonymous');
    script.async = true;
    
    container.appendChild(script);
  }

  loadGiscus();

  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'class') {
        const iframe = document.querySelector('.giscus-frame');
        if (iframe && iframe.contentWindow) {
          const theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: theme } } },
            'https://giscus.app'
          );
        }
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true });
</script>